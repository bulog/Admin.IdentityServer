(function(n,t,i){function h(){for(var r,u,n=[],i="0123456789abcdef",t=0;t<36;t++)n[t]=i.substr(Math.floor(Math.random()*16),1);n[14]="4";n[19]=i.substr(n[19]&3|8,1);n[8]=n[13]=n[18]=n[23]="-";r="slider-"+n.join("");u="point-"+n.join("");console.log(localStorage.getItem("slider"));localStorage.getItem("slider")||localStorage.setItem("slider",r);localStorage.getItem("point")||localStorage.setItem("point",u)}function o(t,r,u,f){n.ajax({type:"get",contentType:"application/json;charset=UTF-8",url:r,data:JSON.stringify(t),cache:!1,crossDomain:!0==!i.all,success:function(n){u(n)},fail:function(n){f(n)}})}function s(t,r,u,f){n.ajax({type:"get",contentType:"application/json;charset=UTF-8",url:r,data:t,cache:!1,crossDomain:!0==!i.all,success:function(n){u(n)},fail:function(n){f(n)}})}var f,e,r,u;h();i.addEventListener("touchstart",function(n){f=n.targetTouches[0].pageX;e=n.targetTouches[0].pageY});i.addEventListener("touchmove",function(n){var t=n.targetTouches[0].pageX,i=n.targetTouches[0].pageY;Math.abs(t-f)>Math.abs(i-e)&&n.preventDefault()},{passive:!1});r=function(t,i){this.$element=t;this.backToken=null;this.moveLeftDistance=0;this.secretKey="";this.data=null;this.defaults={baseUrl:"http://localhost:8000",getUrl:"http://localhost:8000/api/admin/auth/get-captcha",checkUrl:"http://localhost:8000/api/admin/auth/check-captcha",containerId:"",captchaType:"blockPuzzle",mode:"embed",vOffset:5,vSpace:5,explain:"向右拖动滑块填充拼图",imgSize:{width:"310px",height:"155px"},blockSize:{width:"40px",height:"40px"},circleRadius:"10px",barSize:{width:"310px",height:"40px"},beforeCheck:function(){return!0},ready:function(){},success:function(){},error:function(){}};this.options=n.extend({},this.defaults,i)};r.prototype={init:function(){var t=this;if(this.loadDom(),t.refresh(),this.options.ready(),this.$element[0].onselectstart=i.body.ondrag=function(){return!1},this.options.mode=="popup"){t.$element.find(".verifybox-close").on("click",function(){t.$element.find(".mask").css("display","none")});n(this.options.containerId).click(function(){return t.options.beforeCheck()&&t.$element.find(".mask").css("display","block"),!1})}this.htmlDoms.move_block.on("touchstart",t.start.bind(t));this.htmlDoms.move_block.on("mousedown",t.start.bind(t));this.htmlDoms.sub_block.on("touchstart",t.start.bind(t));this.htmlDoms.sub_block.on("mousedown",t.start.bind(t));t.$element.find(".verify-refresh").on("click",function(){t.isEnd==!1&&t.refresh()})},loadDom:function(){this.isMobile=!1;this.status=!1;this.isEnd=!1;this.setSize=this.resetSize(this);this.plusWidth=0;this.plusHeight=0;this.x=0;this.y=0;var n="";this.lengthPercent=(parseInt(this.setSize.img_width)-parseInt(this.setSize.block_width)-parseInt(this.setSize.circle_radius)-parseInt(this.setSize.circle_radius)*.8)/(parseInt(this.setSize.img_width)-parseInt(this.setSize.bar_height));wrapStartHtml='<div class="mask"><div class="verifybox" style="width:'+(parseInt(this.setSize.img_width)+30)+'px"><div class="verifybox-top">请完成安全验证<span class="verifybox-close"><i class="iconfont icon-close"><\/i><\/span><\/div><div class="verifybox-bottom" style="padding:15px"><div style="position: relative;">';this.options.mode=="popup"&&(n=wrapStartHtml);n+='<div class="verify-img-out'+(this.options.mode=="hover"?" verify-img-out-hover":"")+'"><div class="verify-img-panel"><div class="verify-refresh" style="z-index:3"><i class="iconfont icon-refresh"><\/i><\/div><span class="verify-tips"  class="suc-bg"><\/span><img src="" class="backImg" style="width:100%;height:100%;display:block"><div class="verify-sub-block"><img src="" class="bock-backImg" alt=""  style="width:100%;height:100%;display:block"><\/div><\/div><\/div>';this.plusWidth=parseInt(this.setSize.block_width)+parseInt(this.setSize.circle_radius)*2-parseInt(this.setSize.circle_radius)*.2;this.plusHeight=parseInt(this.setSize.block_height)+parseInt(this.setSize.circle_radius)*2-parseInt(this.setSize.circle_radius)*.2;n+='<div class="verify-bar-area" style="width:'+this.setSize.img_width+",height:"+this.setSize.bar_height+",line-height:"+this.setSize.bar_height+'"><span  class="verify-msg">'+this.options.explain+'<\/span><div class="verify-left-bar"><span class="verify-msg"><\/span><\/div><div  class="verify-move-block"><i  class="verify-icon iconfont icon-right"><\/i><\/div><\/div>';wrapEndHtml="<\/div><\/div><\/div><\/div>";this.options.mode=="popup"&&(n+=wrapEndHtml);this.$element.append(n);this.htmlDoms={tips:this.$element.find(".verify-tips"),sub_block:this.$element.find(".verify-sub-block"),out_panel:this.$element.find(".verify-img-out"),img_panel:this.$element.find(".verify-img-panel"),img_canvas:this.$element.find(".verify-img-canvas"),bar_area:this.$element.find(".verify-bar-area"),move_block:this.$element.find(".verify-move-block"),left_bar:this.$element.find(".verify-left-bar"),msg:this.$element.find(".verify-msg"),icon:this.$element.find(".verify-icon"),refresh:this.$element.find(".verify-refresh")};this.$element.css("position","relative");this.htmlDoms.sub_block.css({height:this.setSize.img_height,width:Math.floor(parseInt(this.setSize.img_width)*47/310)+"px"});this.htmlDoms.out_panel.css("height",parseInt(this.setSize.img_height)+this.options.vSpace+"px");this.htmlDoms.img_panel.css({width:this.setSize.img_width,height:this.setSize.img_height});this.htmlDoms.bar_area.css({width:this.setSize.img_width,height:this.setSize.bar_height,"line-height":this.setSize.bar_height});this.htmlDoms.move_block.css({width:this.setSize.block_width,height:this.setSize.bar_height});this.htmlDoms.left_bar.css({width:this.setSize.bar_height,height:this.setSize.bar_height})},start:function(t){var u,r;if(t.originalEvent.targetTouches?(this.isMobile=!0,u=t.originalEvent.targetTouches[0].pageX):u=t.clientX,this.startLeft=Math.floor(u-this.htmlDoms.bar_area[0].getBoundingClientRect().left),this.startMoveTime=(new Date).getTime(),this.isEnd==!1){if(r=this,this.isMobile&&this.options.mode=="hover"){this.htmlDoms.out_panel.show();this.$element.off("mousedown.hover").on("mousedown.hover",function(){return!1});n(i).off("mousedown.hover").on("mousedown.hover",function(){r.htmlDoms.out_panel.hide();n(i).off("mousedown.hover")})}this.status=!0;n(i).on("touchmove",r.move.bind(r));n(i).on("mousemove",r.move.bind(r));n(i).on("touchend",r.end.bind(r));n(i).on("mouseup",r.end.bind(r))}},move:function(n){var r,u,t,i;n.preventDefault();this.status&&this.isEnd==!1&&(r=n.originalEvent.targetTouches?n.originalEvent.targetTouches[0].pageX:n.clientX,u=this.htmlDoms.bar_area[0].getBoundingClientRect().left,t=r-u,t>=this.htmlDoms.bar_area[0].offsetWidth-parseInt(this.setSize.bar_height)+parseInt(parseInt(this.setSize.block_width)/2)-2&&(t=this.htmlDoms.bar_area[0].offsetWidth-parseInt(this.setSize.bar_height)+parseInt(parseInt(this.setSize.block_width)/2)-2),t<=parseInt(parseInt(this.setSize.block_width)/2)&&(t=parseInt(parseInt(this.setSize.block_width)/2)),i=t-this.startLeft,this.htmlDoms.move_block.css("left",i+"px"),this.htmlDoms.left_bar.css("width",i+parseInt(this.setSize.block_width)+"px"),this.htmlDoms.sub_block.css("left",i+"px"),this.moveLeftDistance=i,i>0&&(this.htmlDoms.msg.text(""),this.htmlDoms.bar_area.addClass("verify-bar-area--moving")))},end:function(){var t,u,r;if(this.endMovetime=(new Date).getTime(),t=this,this.status&&this.isEnd==!1){if(this.status=!1,u=parseInt(this.moveLeftDistance),!(u>0))return;this.moveLeftDistance=parseInt(this.moveLeftDistance*310/parseInt(this.setSize.img_width));r={captchaType:this.options.captchaType,data:this.secretKey?aesEncrypt(JSON.stringify({x:this.moveLeftDistance}),this.secretKey):JSON.stringify({x:this.moveLeftDistance}),token:this.backToken,clientUid:localStorage.getItem("slider"),ts:Date.now()};s(r,this.options.checkUrl,function(n){n.success?(t.htmlDoms.bar_area.removeClass("verify-bar-area--moving"),t.htmlDoms.bar_area.addClass("verify-bar-area--success"),t.htmlDoms.icon.removeClass("icon-right"),t.htmlDoms.icon.addClass("icon-check"),t.htmlDoms.tips.addClass("suc-bg").removeClass("err-bg"),t.htmlDoms.tips.animate({bottom:"0px"}),t.htmlDoms.tips.text(((t.endMovetime-t.startMoveTime)/1e3).toFixed(2)+"s验证成功"),t.isEnd=!0,t.options.mode=="hover"&&(t.$element.off("mouseenter"),t.$element.off("mouseleave")),t.htmlDoms.refresh.hide(),setTimeout(function(){t.$element.find(".mask").css("display","none");t.htmlDoms.tips.animate({bottom:"-35px"});t.options.mode=="hover"&&t.htmlDoms.out_panel.hide();t.options.success(r)},1e3),t.data=r):(this.data=null,t.htmlDoms.icon.removeClass("icon-right"),t.htmlDoms.icon.addClass("icon-close"),t.htmlDoms.bar_area.removeClass("verify-bar-area--moving"),t.htmlDoms.bar_area.addClass("verify-bar-area--error"),setTimeout(function(){t.refresh();t.htmlDoms.tips.animate({bottom:"-35px"})},1e3),t.options.error(this))})}n(i).off("touchmove");n(i).off("mousemove");n(i).off("touchend");n(i).off("mouseup")},resetSize:function(i){var f,e,o,s,h,c,l,u=i.$element.parent().width()||n(t).width(),r=i.$element.parent().height()||n(t).height();return f=i.options.imgSize.width.indexOf("%")!=-1?parseInt(i.options.imgSize.width)/100*u+"px":i.options.imgSize.width,e=i.options.imgSize.height.indexOf("%")!=-1?parseInt(i.options.imgSize.height)/100*r+"px":i.options.imgSize.height,o=i.options.barSize.width.indexOf("%")!=-1?parseInt(i.options.barSize.width)/100*u+"px":i.options.barSize.width,s=i.options.barSize.height.indexOf("%")!=-1?parseInt(i.options.barSize.height)/100*r+"px":i.options.barSize.height,i.options.blockSize&&(h=i.options.blockSize.width.indexOf("%")!=-1?parseInt(i.options.blockSize.width)/100*u+"px":i.options.blockSize.width,c=i.options.blockSize.height.indexOf("%")!=-1?parseInt(i.options.blockSize.height)/100*r+"px":i.options.blockSize.height),i.options.circleRadius&&(l=i.options.circleRadius.indexOf("%")!=-1?parseInt(i.options.circleRadius)/100*r+"px":i.options.circleRadius),{img_width:f,img_height:e,bar_width:o,bar_height:s,block_width:h,block_height:c,circle_radius:l}},refresh:function(){this.data=null;var n=this;if(this.htmlDoms.refresh.show(),this.$element.find(".verify-msg:eq(1)").text(""),this.$element.find(".verify-msg:eq(1)").css("color","#000"),this.htmlDoms.move_block.animate({left:"0px"},"fast"),this.htmlDoms.left_bar.animate({width:parseInt(this.setSize.bar_height)},"fast"),this.htmlDoms.bar_area.removeClass("verify-bar-area--moving verify-bar-area--error verify-bar-area--success"),this.htmlDoms.icon.removeClass("icon-close"),this.htmlDoms.icon.addClass("icon-right"),this.$element.find(".verify-msg:eq(0)").text(this.options.explain),this.isEnd=!1,this.status=!1,this.moveLeftDistance=0,o({captchaType:"blockPuzzle",clientUid:localStorage.getItem("slider"),ts:Date.now()},this.options.getUrl,function(t){t.success?(n.$element.find(".backImg")[0].src=t.data.data.baseImage,n.$element.find(".bock-backImg")[0].src=t.data.data.blockImage,n.secretKey=t.data.data.secretKey,n.backToken=t.data.token):(n.$element.find(".backImg")[0].src="images/default.jpg",n.$element.find(".bock-backImg")[0].src="",n.htmlDoms.tips.addClass("err-bg").removeClass("suc-bg"),n.htmlDoms.tips.animate({bottom:"0px"}),n.htmlDoms.tips.text(t.repMsg),setTimeout(function(){n.htmlDoms.tips.animate({bottom:"-35px"})},1e3))}),this.htmlDoms.sub_block.css("left","0px"),this.options.mode=="hover"){this.$element.off("mouseenter").on("mouseenter",function(){n.htmlDoms.out_panel.show()});this.$element.off("mouseleave").on("mouseleave",function(){n.htmlDoms.out_panel.hide()})}},getData:function(){return this.data}};u=function(t,i){this.$element=t;this.backToken=null;this.secretKey="";this.defaults={baseUrl:"//localhost:8000",captchaType:"clickWord",containerId:"",mode:"embed",checkNum:3,vSpace:5,imgSize:{width:"310px",height:"155px"},barSize:{width:"310px",height:"50px"},beforeCheck:function(){return!0},ready:function(){},success:function(){},error:function(){}};this.options=n.extend({},this.defaults,i)};u.prototype={init:function(){var t=this;if(t.loadDom(),t.refresh(),t.options.ready(),this.$element[0].onselectstart=i.body.ondrag=function(){return!1},this.options.mode=="popup"){t.$element.find(".verifybox-close").on("click",function(){t.$element.find(".mask").css("display","none")});n(this.options.containerId).click(function(){return t.options.beforeCheck()&&t.$element.find(".mask").css("display","block"),!1})}t.$element.find(".back-img").on("click",function(n){t.checkPosArr.push(t.getMousePos(this,n));t.num==t.options.checkNum&&(t.num=t.createPoint(t.getMousePos(this,n)),t.checkPosArr=t.pointTransfrom(t.checkPosArr,t.setSize),setTimeout(function(){var n={captchaType:t.options.captchaType,pointJson:t.secretKey?aesEncrypt(JSON.stringify(t.checkPosArr),t.secretKey):JSON.stringify(t.checkPosArr),token:t.backToken,clientUid:localStorage.getItem("point"),ts:Date.now()},i=t.secretKey?aesEncrypt(t.backToken+"---"+JSON.stringify(t.checkPosArr),t.secretKey):t.backToken+"---"+JSON.stringify(t.checkPosArr);s(n,t.options.baseUrl,function(n){n.repCode=="0000"?(t.$element.find(".verify-bar-area").css({color:"#4cae4c","border-color":"#5cb85c"}),t.$element.find(".verify-msg").text("验证成功"),t.$element.find(".verify-img-panel").unbind("click"),setTimeout(function(){t.$element.find(".mask").css("display","none")},1e3),t.options.success({captchaVerification:i})):(t.options.error(t),t.$element.find(".verify-bar-area").css({color:"#d9534f","border-color":"#d9534f"}),t.$element.find(".verify-msg").text("验证失败"),setTimeout(function(){t.$element.find(".verify-bar-area").css({color:"#000","border-color":"#ddd"});t.refresh()},400))})},400));t.num<t.options.checkNum&&(t.num=t.createPoint(t.getMousePos(this,n)))});t.$element.find(".verify-refresh").on("click",function(){t.refresh()})},loadDom:function(){this.fontPos=[];this.checkPosArr=[];this.num=1;var n="",t="";this.setSize=r.prototype.resetSize(this);t='<div class="mask"><div class="verifybox" style="width:'+(parseInt(this.setSize.img_width)+30)+'px"><div class="verifybox-top">请完成安全验证<span class="verifybox-close"><i class="iconfont icon-close"><\/i><\/span><\/div><div class="verifybox-bottom" style="padding:15px"><div style="position: relative;">';this.options.mode=="popup"&&(n=t);n+='<div class="verify-img-out"><div class="verify-img-panel"><div class="verify-refresh" style="z-index:3"><i class="iconfont icon-refresh"><\/i><\/div><img src="" class="back-img" width="'+this.setSize.img_width+'" height="'+this.setSize.img_height+'"><\/div><\/div><div class="verify-bar-area" style="width:'+this.setSize.img_width+",height:"+this.setSize.bar_height+",line-height:"+this.setSize.bar_height+'"><span  class="verify-msg"><\/span><\/div>';wrapEndHtml="<\/div><\/div><\/div><\/div>";this.options.mode=="popup"&&(n+=wrapEndHtml);this.$element.append(n);this.htmlDoms={back_img:this.$element.find(".back-img"),out_panel:this.$element.find(".verify-img-out"),img_panel:this.$element.find(".verify-img-panel"),bar_area:this.$element.find(".verify-bar-area"),msg:this.$element.find(".verify-msg")};this.$element.css("position","relative");this.htmlDoms.out_panel.css("height",parseInt(this.setSize.img_height)+this.options.vSpace+"px");this.htmlDoms.img_panel.css({width:this.setSize.img_width,height:this.setSize.img_height,"background-size":this.setSize.img_width+" "+this.setSize.img_height,"margin-bottom":this.options.vSpace+"px"});this.htmlDoms.bar_area.css({width:this.setSize.img_width,height:this.setSize.bar_height,"line-height":this.setSize.bar_height})},getMousePos:function(r,u){var f=u||t.event,s=i.documentElement.scrollLeft||i.body.scrollLeft,h=i.documentElement.scrollTop||i.body.scrollTop,e=f.clientX-(n(r).offset().left-n(t).scrollLeft()),o=f.clientY-(n(r).offset().top-n(t).scrollTop());return{x:e,y:o}},createPoint:function(n){return this.htmlDoms.img_panel.append('<div class="point-area" style="background-color:#1abd6c;color:#fff;z-index:9999;width:20px;height:20px;text-align:center;line-height:20px;border-radius: 50%;position:absolute;top:'+parseInt(n.y-10)+"px;left:"+parseInt(n.x-10)+'px;">'+this.num+"<\/div>"),++this.num},refresh:function(){var n=this;this.$element.find(".point-area").remove();this.fontPos=[];this.checkPosArr=[];this.num=1;o({captchaType:"clickWord",clientUid:localStorage.getItem("point"),ts:Date.now()},n.options.baseUrl,function(t){if(t.repCode=="0000"){n.htmlDoms.back_img[0].src="data:image/png;base64,"+t.repData.originalImageBase64;n.backToken=t.repData.token;n.secretKey=t.repData.secretKey;var i="请依次点击【"+t.repData.wordList.join(",")+"】";n.$element.find(".verify-msg").text(i)}else n.htmlDoms.back_img[0].src="images/default.jpg",n.$element.find(".verify-msg").text(t.repMsg)})},pointTransfrom:function(n,t){return n.map(function(n){var i=Math.round(310*n.x/parseInt(t.img_width)),r=Math.round(155*n.y/parseInt(t.img_height));return{x:i,y:r}})}};n.fn.slideVerify=function(n){var t=new r(this,n);return t.options.mode=="popup"?t.init():t.options.mode=="embed"?t.init():t.options.mode=="hover"&&t.init(),t};n.fn.pointsVerify=function(n){var t=new u(this,n);return t.options.mode=="popup"?t.init():t.options.mode=="embed"&&t.init(),t}})(jQuery,window,document);